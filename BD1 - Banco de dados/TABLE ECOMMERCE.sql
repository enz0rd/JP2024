-- CRIAÇÃO DA TABELA VENDEDORES
CREATE TABLE VENDEDORES (
    ID SERIAL PRIMARY KEY,
    NOME VARCHAR(100),
    COMISSAO FLOAT
);

-- CRIAÇÃO DA TABELA CLIENTES
CREATE TABLE CLIENTES (
    ID SERIAL PRIMARY KEY,
    NOME VARCHAR(100),
    CPF VARCHAR(11),
    DATA_NASCIMENTO DATE,
    LOGRADOURO VARCHAR(100),
    BAIRRO VARCHAR(20),
    CEP VARCHAR(8),
    CIDADE VARCHAR(100),
    UF CHAR(2)
);

-- CRIAÇÃO DA TABELA PRODUTOS
CREATE TABLE PRODUTOS (
    ID SERIAL PRIMARY KEY,
    NOME VARCHAR(100),
    PRECO FLOAT,
    QUANTIDADE FLOAT,
    CODIGO_BARRA VARCHAR(13),
    UNIDADE_MEDIDA CHAR(3)
);

-- CRIAÇÃO DA TABELA VENDAS
CREATE TABLE VENDAS (
    ID SERIAL PRIMARY KEY,
    DATA_HORA TIMESTAMP,
    NUMERO INT,
    STATUS VARCHAR(10),
    DESCONTO FLOAT,
    ACRESCIMO FLOAT,
    VENDEDOR_ID INT,
    CLIENTE_ID INT
);

-- CRIAÇÃO DA TABELA VENDAS_ITENS
CREATE TABLE VENDAS_ITENS (
    ID SERIAL PRIMARY KEY,
    QUANTIDADE FLOAT,
    VALOR_UN FLOAT,
    DESCONTO FLOAT,
    ACRESCIMO FLOAT,
    VENDA_ID INT,
    PRODUTO_ID INT
);

-- CRIAÇÃO DE FK DAS TABELAS
ALTER TABLE VENDAS ADD CONSTRAINT FK_VENDEDOR FOREIGN KEY (VENDEDOR_ID) REFERENCES VENDEDORES(ID); 
ALTER TABLE VENDAS ADD CONSTRAINT FK_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTES(ID); 
ALTER TABLE VENDAS_ITENS ADD CONSTRAINT FK_VENDA FOREIGN KEY (VENDA_ID) REFERENCES VENDAS(ID);
ALTER TABLE VENDAS_ITENS ADD CONSTRAINT FK_PRODUTO FOREIGN KEY (PRODUTO_ID) REFERENCES PRODUTOS(ID);

-- INSERTS:
INSERT INTO PRODUTOS(NOME, PRECO, QUANTIDADE, CODIGO_BARRA, UNIDADE_MEDIDA) 
VALUES ('COCA COLA 600 ML', 3.99, 20, '7894900011609', 'UND');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('LUÍS GUSTAVO LIMA MARCONATO', '03120313008', '1992-08-19', 'ABRAMO EBERLE','CENTRO', '12345678', 'CONCORDIA','SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('LARISSA LETÍCIA LIMA MARCONATO', '03120313009', '1999-08-16', 'LINHA CATETO','INTERIOR', '12345678', 'CONCORDIA','SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('MARIA SILVA', '12345678901', '1985-05-15', 'RUA DAS FLORES', 'JARDIM', '11111111', 'FLORIANÓPOLIS', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('JOÃO PEREIRA', '23456789012', '1978-12-03', 'AVENIDA CENTRAL', 'CENTRO', '22222222', 'BLUMENAU', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('ANA COSTA', '34567890123', '1990-07-22', 'RUA DAS OLIVEIRAS', 'JARDIM OLIVEIRA', '33333333', 'JOINVILLE', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('CARLOS MENDES', '45678901234', '1982-11-11', 'TRAVESSA DOS PINHEIROS', 'PARQUE DAS ÁRVORES', '44444444', 'LAGES', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('BEATRIZ OLIVEIRA', '56789012345', '1995-03-30', 'RUA DO SOL', 'VILA SOL', '55555555', 'BALNEÁRIO CAMBORIÚ', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('PEDRO ALVES', '67890123456', '1987-09-10', 'AVENIDA ATLÂNTICA', 'PRAIA', '66666666', 'ITAJAÍ', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('LUCIANA DIAS', '78901234567', '1993-04-05', 'RUA DAS ACÁCIAS', 'PARQUE DAS ACÁCIAS', '77777777', 'SÃO JOSÉ', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('ROBERTO NUNES', '89012345678', '1980-01-25', 'RUA DAS MANGUEIRAS', 'JARDIM MANGUEIRAS', '88888888', 'PALHOÇA', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('FERNANDA LOPES', '90123456789', '1997-06-18', 'AVENIDA DAS AMÉRICAS', 'AMÉRICAS', '99999999', 'TUBARÃO', 'SC');

INSERT INTO CLIENTES(NOME, CPF, DATA_NASCIMENTO, LOGRADOURO, BAIRRO, CEP, CIDADE, UF) 
VALUES ('ANDRÉ PINTO', '01234567890', '1989-10-09', 'RUA DO LAGO', 'LAGO AZUL', '00000000', 'CRICIÚMA', 'SC');


-- INSERIR VENDEDORES 
INSERT INTO VENDEDORES(NOME, COMISSAO) VALUES('EVANDRO', 5.00);
INSERT INTO VENDEDORES(NOME, COMISSAO) VALUES('PEDRO', 6.00);
INSERT INTO VENDEDORES(NOME, COMISSAO) VALUES('CARLOS', 7.00);
INSERT INTO VENDEDORES(NOME, COMISSAO) VALUES('GUSTAVO', 3.00);
INSERT INTO VENDEDORES(NOME, COMISSAO) VALUES('MARIA', 6.00);
INSERT INTO VENDEDORES(NOME, COMISSAO) VALUES('GABRIELA', 7.00);
INSERT INTO VENDEDORES(NOME, COMISSAO) VALUES('SABRINA', 8.00);

select * from clientes

-- INSERIR VENDAS
INSERT INTO VENDAS (DATA_HORA, NUMERO, STATUS, DESCONTO, ACRESCIMO, VENDEDOR_ID, CLIENTE_ID)
VALUES 
    (now(), 1, 'Pendente', 0, 0, 8, 3),
    (now(), 2, 'Pendente', 0, 0, 9, 3),
    (now(), 3, 'Pendente', 0, 0, 9, 4),
    (now(), 4, 'Pendente', 0, 0, 10, 3),
    (now(), 5, 'Pendente', 0, 0, 11, 4),
    (now(), 6, 'Pendente', 0, 0, 12, 4),
    (now(), 7, 'Pendente', 0, 0, 13, 3),
    (now(), 8, 'Pendente', 0, 0, 14, 3),
    (now(), 9, 'Pendente', 0, 0, 8, 4),
    (now(), 10, 'Pendente', 0, 0,9, 4),
    (now(), 11, 'Pendente', 0, 0, 10, 3),
    (now(), 12, 'Pendente', 0, 0, 11, 3),
    (now(), 13, 'Pendente', 0, 0, 12, 3),
    (now(), 14, 'Pendente', 0, 0, 13, 3),
    (now(), 15, 'Pendente', 0, 0, 14, 4),
    (now(), 16, 'Pendente', 0, 0, 8, 3);

select * from produtos

-- INSERIR PRODUTOS NAS VENDAS 
INSERT INTO VENDAS_ITENS (QUANTIDADE, VALOR_UN, DESCONTO, ACRESCIMO, VENDA_ID, PRODUTO_ID)
VALUES 
    (1, 6.99, 0, 0, 49, 4),
    (3, 7.99, 0, 0, 49, 5),
    (6, 5.99, 0, 0, 49, 6),
    (6, 5.99, 0, 0, 50, 6),
    (4, 5.99, 0, 0, 51, 5),
    (6, 5.99, 0, 0, 51, 5),
    (2, 5.99, 0, 0, 52, 6),
    (3, 7.99, 0, 0, 53, 8),
    (4, 6.99, 0, 0, 54, 4),
    (2, 5.99, 0, 0, 55, 6),
    (6, 3.99, 0, 0, 56, 7),
    (2, 3.99, 0, 0, 57, 7),
    (1, 6.99, 0, 0, 58, 5);

CREATE TABLE PAGAR (
    ID SERIAL PRIMARY KEY,
    CLIENTE_ID INTEGER REFERENCES CLIENTES(ID),
    VALOR_CONTA FLOAT,
    VALOR_PAGO FLOAT,
    DATA_VENCIMENTO TIMESTAMP,
    DATA_PAGAMENTO TIMESTAMP,
    DATA_EMISSAO TIMESTAMP,
    STATUS VARCHAR(25)
);

CREATE TABLE RECEBER (
    ID SERIAL PRIMARY KEY,
    CLIENTE_ID INTEGER REFERENCES CLIENTES(ID),
    VALOR_CONTA FLOAT,
    VALOR_PAGO FLOAT,
    DATA_VENCIMENTO TIMESTAMP,
    DATA_PAGAMENTO TIMESTAMP,
    DATA_EMISSAO TIMESTAMP,
    STATUS VARCHAR(25)
);

select * from clientes

INSERT INTO PAGAR (CLIENTE_ID, VALOR_CONTA, VALOR_PAGO, DATA_VENCIMENTO, DATA_PAGAMENTO, DATA_EMISSAO, STATUS) VALUES
(8, 100.00, 100.00, '2024-07-01 12:00:00', '2024-07-01 12:00:00', '2024-06-01 12:00:00', 'Pago'),
(8, 150.00, 0.00, '2024-07-15 12:00:00', NULL, '2024-06-15 12:00:00', 'Pendente'),
(9, 200.00, 200.00, '2024-07-05 12:00:00', '2024-07-05 12:00:00', '2024-06-05 12:00:00', 'Pago'),
(9, 300.00, 150.00, '2024-07-10 12:00:00', '2024-07-09 12:00:00', '2024-06-10 12:00:00', 'Parcial'),
(10, 400.00, 400.00, '2024-07-20 12:00:00', '2024-07-20 12:00:00', '2024-06-20 12:00:00', 'Pago'),
(10, 250.00, 0.00, '2024-07-25 12:00:00', NULL, '2024-06-25 12:00:00', 'Pendente'),
(11, 350.00, 350.00, '2024-07-30 12:00:00', '2024-07-30 12:00:00', '2024-06-30 12:00:00', 'Pago'),
(11, 500.00, 250.00, '2024-07-07 12:00:00', '2024-07-06 12:00:00', '2024-06-07 12:00:00', 'Parcial'),
(12, 450.00, 450.00, '2024-07-09 12:00:00', '2024-07-09 12:00:00', '2024-06-09 12:00:00', 'Pago'),
(12, 600.00, 0.00, '2024-07-12 12:00:00', NULL, '2024-06-12 12:00:00', 'Pendente');

-- Inserting 10 records into RECEBER table
INSERT INTO RECEBER (CLIENTE_ID, VALOR_CONTA, VALOR_PAGO, DATA_VENCIMENTO, DATA_PAGAMENTO, DATA_EMISSAO, STATUS) VALUES
(8, 200.00, 200.00, '2024-07-02 12:00:00', '2024-07-02 12:00:00', '2024-06-02 12:00:00', 'Recebido'),
(8, 300.00, 0.00, '2024-07-16 12:00:00', NULL, '2024-06-16 12:00:00', 'Pendente'),
(9, 400.00, 400.00, '2024-07-06 12:00:00', '2024-07-06 12:00:00', '2024-06-06 12:00:00', 'Recebido'),
(9, 600.00, 300.00, '2024-07-11 12:00:00', '2024-07-10 12:00:00', '2024-06-11 12:00:00', 'Parcial'),
(10, 800.00, 800.00, '2024-07-21 12:00:00', '2024-07-21 12:00:00', '2024-06-21 12:00:00', 'Recebido'),
(10, 500.00, 0.00, '2024-07-26 12:00:00', NULL, '2024-06-26 12:00:00', 'Pendente'),
(11, 700.00, 700.00, '2024-07-31 12:00:00', '2024-07-31 12:00:00', '2024-06-30 12:00:00', 'Recebido'),
(11, 1000.00, 500.00, '2024-07-08 12:00:00', '2024-07-07 12:00:00', '2024-06-08 12:00:00', 'Parcial'),
(12, 900.00, 900.00, '2024-07-10 12:00:00', '2024-07-10 12:00:00', '2024-06-10 12:00:00', 'Recebido'),
(12, 1200.00, 0.00, '2024-07-13 12:00:00', NULL, '2024-06-13 12:00:00', 'Pendente');

select r.cliente_id, c.nome, r.valor_conta, r.data_vencimento, r.data_pagamento, r.valor_pago, r.status 
	from receber r
join clientes c on c.id = r.cliente_id

select p.cliente_id, c.nome, p.valor_conta, p.data_vencimento, p.data_pagamento, p.valor_pago, p.status 
	from pagar p
join clientes c on c.id = p.cliente_id

SELECT c.nome, 
       SUM(r.valor_conta) AS receber, 
       SUM(p.valor_conta) AS pagar 
FROM clientes c
JOIN receber r ON c.id = r.cliente_id
JOIN pagar p ON c.id = p.cliente_id
GROUP BY c.nome;
